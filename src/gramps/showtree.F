C *************************************************************
C This file contains source code for the gMol computer program
C  Copyright (C) 1981-2010 by TJ O'Donnell and
C  Copyright (C) 2005-2010 gNova, Inc.
C It is unlawful to modify or remove this copyright notice.
C See the accompanying LICENSE file for further information. 
C *************************************************************
	SUBROUTINE SHOWTREE(ARG)
C
	IMPLICIT NONE
	CHARACTER ARG*(*)
C
	INTEGER START, FINISH, DEPTH, LVL, SIZE
	INTEGER TRLVL, LEVEL, I, J, K
	CHARACTER BLANK*1
#include "UDLIST.FOR"
#include "ERRORS.FOR"
	EXTERNAL TRIM
	CHARACTER TAB*5
	CHARACTER*120 TMPLINE
	CHARACTER*40 NAMOUT
	DATA TAB/'     '/
	DATA BLANK/' '/
	TAB='     '
	BLANK=' '
C
C	 IF NOTHING IN THE TREE, FORGET IT
C
	CALL SHWOLI
	IF(TREEEND.EQ.0)RETURN
	IF(ARG.NE.BLANK)THEN
	  POINT=1
	  CALL NAMID(ARG,POINT,ID)
	  IF(ERROR.NE.0)CALL TELLUSER(ERROR,*999)
	  CALL GROUPINFO(ID,START,FINISH,DEPTH,LVL,SIZE)
	  IF(ID.LE.RWORLD)START=1
	  IF(POINT.NE.0)THEN
	    CALL GETVLU(ARG,POINT,TRLVL,ADDIT)
	    IF(ERROR.NE.0)CALL TELLUSER(ERROR,*999)
	    IF(TRLVL.LE.0)TRLVL=0
	  ELSE
	    TRLVL=0
	  END IF
	ELSE
	  TRLVL=0
	  START=1
	  FINISH=TREEEND
	END IF
	LEVEL=0
C
C	 DISPLAY THE NAMES OF OBJECTS IN THE ORDER THAT THEY HAVE
C	 IN THE TREE.  A LEVEL OF GROUPING IS INDICATED BY TABING
C	 BEFORE WRITING THE GROUP NAME.  AFTER THE GROUP_END
C	 GO BACK A LEVEL (A TAB).
C
	DO 10 I=START,FINISH
	J=TREE(I)
	IF (J.LE.GROUPEND)THEN
	  LEVEL=LEVEL-1
	ELSE
	  IF( (TRLVL.EQ.0).OR.(LEVEL+1.LE.TRLVL) )THEN
	    IF( BTEST(KINDOBJ(J),SYNOBIT).AND. J.NE.MASTSYN(J) )THEN
		NAMOUT=NAMOBJ(J)(:TRIM(NAMOBJ(J)))//'-->'//NAMOBJ(FRMCNT(J))
	  ELSE
		NAMOUT=NAMOBJ(J)
	  END IF
	    IF( BTEST(KINDOBJ(J),BLNKBIT) )THEN
	      WRITE(TMPLINE,1000) (TAB,K=1,LEVEL),
     &	  '('//NAMOUT(:TRIM(NAMOUT))//')'
	    ELSE
	      WRITE(TMPLINE,1000) (TAB,K=1,LEVEL),NAMOUT
	    END IF
	    CALL GROUT(TMPLINE)
	  END IF
	  IF (TYPOBJ(J).EQ.GROUP) LEVEL=LEVEL+1
	END IF
 10   CONTINUE
 1000 FORMAT(14A)
C
 999  RETURN
	END
C
	SUBROUTINE SHWOLI
	IMPLICIT NONE
C
#include "UDLIST.FOR"
	INTEGER I, NLEN, LOBJ
C
	CALL INITBUFF('<')
	CALL PUTBUFF( NAMOBJ(LWORLD) )
	IF(STEREO.NE.NOSTEREO)CALL PUTBUFF( NAMOBJ(RWORLD) )
	DO 10 i=1,NLITES
	lobj = GLITE1 + i - 1
	  IF( BTEST(KINDOBJ(lobj),BLNKBIT) )then
c		nlen = TRIM(NAMOBJ(lobj))
c		CALL PUTBUFF( '(' // NAMOBJ(lobj)(:nlen) // ')' )
	  ELSE
		CALL PUTBUFF( NAMOBJ(lobj) )
	  END IF
 10	CONTINUE
	CALL PUTBUFF('>')
	CALL ENDBUFF
C
	RETURN
	END
