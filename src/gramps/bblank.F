C *************************************************************
C This file contains source code for the gMol computer program
C  Copyright (C) 1981-2010 by TJ O'Donnell and
C  Copyright (C) 2005-2010 gNova, Inc.
C It is unlawful to modify or remove this copyright notice.
C See the accompanying LICENSE file for further information. 
C *************************************************************
      SUBROUTINE BBLANK(ARG)
C
      IMPLICIT NONE
C
#include "UDLIST.FOR"
#include "ERRORS.FOR"
      INTEGER SIZE
      INTEGER START, FINISH, DEPTH, LEVEL, I, K
C
      CHARACTER ARG*(*)
C
C       THIS ROUTINE MARKS OBJECTS FOR NON-DISPLAY BY
C       SETTING THEIR BLANK BIT.
C
      POINT=1
 5    CALL NAMID(ARG,POINT,ID)
      IF(ERROR.NE.0)CALL TELLUSER(ERROR,*999)
C
C       IF THE OBJ IS A GROUP, BLANK EACH GROUP MEMBER.
C       THE TREE CONTAINS SPECIAL GROUP_END MARKERS WHICH
C       HAVE NO KINDOBJ ENTRY, SO MODIFY THE GROUP_END MARKER
C       TO BE A GROUP_END_BLANKED MARKER.
C
      IF( BTEST(KINDOBJ(ID),MENUBIT) )THEN
        MCHANGE=.TRUE.
      ELSE
        TCHANGE=.TRUE.
      END IF
C
      IF( TYPOBJ(ID).NE.GROUP)THEN
	CALL BLNKOBJ(ID)
C       LOCOBJ(ID)=-IABS(LOCOBJ(ID))
      ELSE
        CALL GROUPINFO(ID,START,FINISH,DEPTH,LEVEL,SIZE)
        DO 10 I=START,FINISH
        K=TREE(I)
        IF( (K.LE.GROUPEND) )THEN
          CONTINUE
        ELSE IF( TYPOBJ(K).EQ.GROUP )THEN
          CONTINUE
        ELSE
	  CALL BLNKOBJ(K)
C         LOCOBJ(K)=-IABS(LOCOBJ(K))
        END IF
 10     CONTINUE
      END IF
C
      IF(POINT.NE.0)GOTO 5
C
 999  RETURN
      END
C
C
      SUBROUTINE DBLANK(ARG)
C
      IMPLICIT NONE
C
#include "UDLIST.FOR"
#include "ERRORS.FOR"
      INTEGER SIZE
C
      CHARACTER ARG*(*)
      INTEGER START, FINISH, DEPTH, LEVEL, I, K
C
C       THIS ROUTINE MARKS OBJECTS FOR DISPLAY BY
C       SETTING THEIR BLANKBIT OFF.
C
      POINT=1
 5    CALL NAMID(ARG,POINT,ID)
      IF(ERROR.NE.0)CALL TELLUSER(ERROR,*999)
C
C       IF THE OBJ IS A GROUP, DEBLANK EACH GROUP MEMBER.
C       THE TREE CONTAINS SPECIAL GROUP_END MARKERS WHICH
C       HAVE NO KINDOBJ ENTRY, SO MODIFY THE GROUP_END MARKER
C       SO THAT IT IS NO LONGER A GROUP_END_BLANKED.
C
      IF( BTEST(KINDOBJ(ID),MENUBIT) )THEN
        MCHANGE=.TRUE.
      ELSE
        TCHANGE=.TRUE.
      END IF
C
      IF( TYPOBJ(ID).NE.GROUP)THEN
	CALL DBLNKOBJ(ID)
C       LOCOBJ(ID)=IABS(LOCOBJ(ID))
      ELSE
        CALL GROUPINFO(ID,START,FINISH,DEPTH,LEVEL,SIZE)
        DO 10 I=START,FINISH
        K=TREE(I)
        IF( (K.LE.GROUPEND) )THEN
          CONTINUE
        ELSE IF( TYPOBJ(K).EQ.GROUP )THEN
          CONTINUE
        ELSE
	  CALL DBLNKOBJ(K)
C         LOCOBJ(K)=IABS(LOCOBJ(K))
        END IF
 10     CONTINUE
      END IF
C
      IF(POINT.NE.0)GOTO 5
C
 999  RETURN
      END
C
	SUBROUTINE BLNKOBJ(K)
C
      IMPLICIT NONE
	INTEGER K
C
#include "UDLIST.FOR"
C
	KINDOBJ(K)=IOR( KINDOBJ(K),BLNKBYTE )
	RETURN
C
	ENTRY DBLNKOBJ(K)
C
	KINDOBJ(K)=IAND( KINDOBJ(K),NOT(BLNKBYTE) )
	RETURN
C
	END
