C *************************************************************
C This file contains source code for the gMol computer program
C  Copyright (C) 1981-2010 by TJ O'Donnell and
C  Copyright (C) 2005-2010 gNova, Inc.
C It is unlawful to modify or remove this copyright notice.
C See the accompanying LICENSE file for further information. 
C *************************************************************
      SUBROUTINE TPOP
C
      IMPLICIT NONE
#include "UDLIST.FOR"
C
      IF(OUTTING.EQ.OUTWINDOW)THEN
        CALL T0POP
      ELSE
        CALL T1POP
      ENDIF
C
      RETURN
      END
C
      SUBROUTINE TGET(MATRIX)
C
      IMPLICIT NONE
      REAL MATRIX(4,4)
#include "UDLIST.FOR"
C
      IF(OUTTING.EQ.OUTWINDOW)THEN
        CALL T0GET(MATRIX)
      ELSE
        CALL T1GET(MATRIX)
      ENDIF
C
      RETURN
      END
C
      SUBROUTINE TMUL(MATRIX)
C
      IMPLICIT NONE
      REAL MATRIX(4,4)
#include "UDLIST.FOR"
C
      IF(OUTTING.EQ.OUTWINDOW)THEN
        CALL T0MUL(MATRIX)
      ELSE
        CALL T1MUL(MATRIX)
      ENDIF
C
      RETURN
      END
C
      SUBROUTINE TSET(MATRIX)
C
      IMPLICIT NONE
      REAL MATRIX(4,4)
#include "UDLIST.FOR"
C
      IF(OUTTING.EQ.OUTWINDOW)THEN
        CALL T0SET(MATRIX)
      ELSE
        CALL T1SET(MATRIX)
      ENDIF
C
      RETURN
      END
C
      SUBROUTINE TPUSH
C
      IMPLICIT NONE
#include "UDLIST.FOR"
C
      IF(OUTTING.EQ.OUTWINDOW)THEN
        CALL T0PUSH
      ELSE
        CALL T1PUSH
      ENDIF
C
      RETURN
      END
C
      SUBROUTINE T1PUSH
C
#include "TFMMAT.FOR"
C
C       THIS ROUTINE COPIES THE CURRENT TFM MATRIX INTO
C       THE NEXT SPOT AND MAKES THAT NEXT SPOT BE THE
C       CURRENT TMF MATRIX.
C
      IF(CURRENT.GE.STACKSIZE)THEN
        CALL GROUT('TOO MANY PUSHES')
        RETURN
      END IF
C
      DO 10 I=1,4
        DO 10 J=1,4
        TFMMTX(I,J,CURRENT+1)=TFMMTX(I,J,CURRENT)
 10   CONTINUE
C
      CURRENT=CURRENT+1
C
      RETURN
C
      ENTRY T1POP
C
C       THIS ROUTINE RETURNS THE PREVIOUSLY PUSHED TFM MATRIX
C       TO CURRENCY, LOSING THE NOW CURRENT TFM MATRIX.
C
      IF(CURRENT.LE.1)THEN
        CALL GROUT('TOO MANY POPS!')
        RETURN
      END IF
C
      CURRENT = CURRENT - 1
C
      RETURN
C
      END
C
C
      SUBROUTINE T1GET(MATRIX)
C
C       THIS ROUTINE RETRIEVES THE CURRENT TFM MATRIX AND PUTS IT
C       IN MATRIX (PASSED AS AND ARG).
C
      REAL MATRIX(4,4)
C
#include "TFMMAT.FOR"
C
      DO 10 I=1,4
      DO 10 J=1,4
      MATRIX(I,J)=TFMMTX(I,J,CURRENT)
 10   CONTINUE
C
      RETURN
C
      ENTRY T1SET(MATRIX)
C
C       THIS ROUTINE MAKES MATRIX BE THE CURRENT TFM MATRIX.
C
      DO 20 I=1,4
      DO 20 J=1,4
      TFMMTX(I,J,CURRENT)=MATRIX(I,J)
 20   CONTINUE
C
      RETURN
C
      ENTRY T1MUL(MATRIX)
C
C       THIS ROUTINE MULTIPLIES MATRIX BY THE CURRENT TFM MATRIX
C	AND MAKES THE PRODUCT THE CURRENT TFM MATRIX.
C
      CALL MATCON(TFMMTX(1,1,CURRENT),MATRIX)
C
      RETURN
C
      END
C
      SUBROUTINE T0PUSH
C
#include "TFMMAT.FOR"
C
C       THIS ROUTINE COPIES THE CURRENT TFM MATRIX INTO
C       THE NEXT SPOT AND MAKES THAT NEXT SPOT BE THE
C       CURRENT TMF MATRIX.
C
      IF(CURRENT.GE.STACKSIZE)THEN
        CALL GROUT('TOO MANY PUSHES')
        RETURN
      END IF
C
      CURRENT=CURRENT+1
      CALL PUSHMA
C
      RETURN
C
      ENTRY T0POP
C
C       THIS ROUTINE RETURNS THE PREVIOUSLY PUSHED TFM MATRIX
C       TO CURRENCY, LOSING THE NOW CURRENT TMF MATRIX.
C
      IF(CURRENT.LE.1)THEN
        CALL GROUT('TOO MANY POPS!')
        RETURN
      END IF
C
      CURRENT = CURRENT - 1
      CALL POPMAT
C
      RETURN
C
      END
C
C
      SUBROUTINE T0GET(MATRIX)
C
C       THIS ROUTINE RETRIEVES THE CURRENT TFM MATRIX AND PUTS IT
C       IN MATRIX (PASSED AS AND ARG).
C
      REAL MATRIX(4,4), XMATRIX(4,4)
C
      CALL GETMAT(XMATRIX)
      CALL XPOSE(XMATRIX,MATRIX)
      RETURN
C
      ENTRY T0SET(MATRIX)
C
C       THIS ROUTINE MAKES MATRIX BE THE CURRENT TFM MATRIX.
C
      CALL XPOSE(MATRIX,XMATRIX)
      CALL LOADMA(XMATRIX)
      RETURN
C
      ENTRY T0MUL(MATRIX)
C
C       THIS ROUTINE MULTIPLIES MATRIX BY THE CURRENT TFM MATRIX
C	AND MAKES THE PRODUCT BE THE CURRENT TFM MATRIX.
C
      CALL XPOSE(MATRIX,XMATRIX)
      CALL MULTMA(XMATRIX)
C
      RETURN
      END
C
      SUBROUTINE XPOSE(MATRIX,XMATRIX)
C
      REAL MATRIX(4,4), XMATRIX(4,4), TMP
C
C     TRANSPOSE MATRIX (IRIS IS BACKWARDS FROM GRAMPS INTERNAL)
C
      DO 10 I=1,4
      DO 10 J=1,4
      XMATRIX(I,J)=MATRIX(J,I)
 10   CONTINUE
C
      RETURN
      END
