C *************************************************************
C This file contains source code for the gMol computer program
C  Copyright (C) 1981-2010 by TJ O'Donnell and
C  Copyright (C) 2005-2010 gNova, Inc.
C It is unlawful to modify or remove this copyright notice.
C See the accompanying LICENSE file for further information. 
C *************************************************************
      SUBROUTINE CLOSEOBJ(OBJTYPE)
C
      IMPLICIT NONE
C
#include "UDLIST.FOR"
C
c      INTEGER UNIQID
c      SAVE UNIQID
c      DATA UNIQID /0/
      INTEGER G0FILL, OBJTYPE
C
C       THIS ROUTINE FINISHES OFF AN OPEN OBJECT AND
C       STORES INFO ABOUT THE SIZE OF THE OBJ.
C       GROUPS, FRAMES AND WORLDS ARE ALL INCOMPLETE
C       AND CANNOT POP-OFF UNTIL THEY GET WHAT THEY NEED,
C       NAMELY GROUP-MEMBERS AND A GROUP-POP, A FRAME-CELL,
C       OR THE END OF THE TREE, RESPECTIVELY.
C
C       A FRAME_CELL IS NOT A NEW GRAMPS OBJECT AND SO
C       DOES NOT BELONG IN THE TREE. WORLDS ALSO ARE
C       NOT IN THE TREE.  GROUPS ARE IN THE TREE, BUT
C       I'M RELYING ON MAKEGROUP TO UPDATE TREEEND AS
C       NEEDED WHEN IT'S FINISHED SHUFFLING AROUND THE
C       TREE TO ACCOMODATE THE NEWLY CREATED GROUP.
C
      IF( (OBJTYPE.NE.FRMCELL).AND.(OBJTYPE.NE.WORLD).AND.
     &  (OBJTYPE.NE.GROUP) .AND. (OBJTYPE.NE.LIGHT)  )
     &  TREEEND=TREEEND+1
C
c      UNIQID=UNIQID+1
c      OBJFRID(NIDS)=UNIQID
      OBJFRSIZ(NIDS)=LENGTH
C
C       ORDINARY OBJECTS, GROUPS, FRAMES AND WORLDS SHOULD
C       INHERET THE INTENSITY AND COLOR OF THE LWORLD.
C
      IF( (OBJTYPE.EQ.ORDINARY).OR.(OBJTYPE.EQ.WORLD).OR.
     &  (OBJTYPE.EQ.FRAME).OR.(OBJTYPE.EQ.GROUP) )THEN
        TFMVAL(UCHUE,NOBJ)=TFMVAL(UCHUE,LWORLD)
        TFMVAL(UCSAT,NOBJ)=TFMVAL(UCSAT,LWORLD)
        TFMVAL(UCVAL,NOBJ)=TFMVAL(UCVAL,LWORLD)
        TFMVAL(UITRNSP,NOBJ)=TFMVAL(UITRNSP,LWORLD)
        TFMVAL(UISPEC,NOBJ)=TFMVAL(UISPEC,LWORLD)
        TFMVAL(UIDIFF,NOBJ)=TFMVAL(UIDIFF,LWORLD)
        TFMVAL(UIAMBI,NOBJ)=TFMVAL(UIAMBI,LWORLD)
        TFMVAL(UISHIN,NOBJ)=TFMVAL(UISHIN,LWORLD)
        TFMVAL(UIEMIS,NOBJ)=TFMVAL(UIEMIS,LWORLD)
      END IF
C
C      Call g0inten(nids)
      Call g0inten(nobj)
      OBJFRID(NIDS)=g0fill( dlist(objfrloc(nids)) , objfrsiz(nids) )
C
C       LET THE DISPLAY PROGRAM KNOW THAT A CHANGE IN THE TREE
C       HAS OCCURRED.
C
      TCHANGE=.TRUE.
      RETURN
      END
