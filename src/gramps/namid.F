C *************************************************************
C This file contains source code for the gMol computer program
C  Copyright (C) 1981-2010 by TJ O'Donnell and
C  Copyright (C) 2005-2010 gNova, Inc.
C It is unlawful to modify or remove this copyright notice.
C See the accompanying LICENSE file for further information. 
C *************************************************************
	SUBROUTINE NAMEID(ARG,SPOINT,NID,NAME)
C
	IMPLICIT NONE
	INTEGER SPOINT, NID
	CHARACTER ARG*(*)
	CHARACTER NAME*(*)
C
#include "UDLIST.FOR"
#include "ERRORS.FOR"
C
	INTEGER VPOINT, NSIZE, ISAVE, I
	CHARACTER*1 BLANK
	BLANK=' '
C
C	 THIS IS A GRAMPS UTILITY SUBROUTINE THAT PARSES
C	 A COMMAND STRING FOR AN OBJECT NAME.  IT  RETURNS
C	 THE NAME OF THE OBJECT AS WELL AS 
C	 THE ID OF THE OBJECT AND UPDATE THE POINTER TO
C	 POINT AT THE NEXT ARG IN THE  COMMAND LINE.
C	 IF THE NAMID TRANSLATION FAILS, THE ARG POINTER
C	 IS NOT CHANGED.
C
C
C	 SAVE THE POINTER AT ENTERING
C
	IF(SPOINT.LE.0)THEN
	  ERROR=NONAME
	  RETURN
	ELSE
	  VPOINT=SPOINT
	END IF
C
C	 PICK OUT THE NAME FROM THE COMMAND STRING
C
	CALL GETSTR(ARG,SPOINT,NAME)
	IF(ERROR.NE.0)RETURN
	IF(NAME.EQ.BLANK)THEN
	  ERROR=NONAME
	  NID=0
	  SPOINT=VPOINT
	  RETURN
	END IF
C
C	 CHECK FOR A MATCH AND GET THE ID OF THE NAME
C
	NID=IDNAME(NAME)
	IF(NID.EQ.0)THEN
	  ERROR=OBJERR
	  SPOINT=VPOINT
	ELSE
	  ERROR=0
	END IF
C
	RETURN
	END
C
C
	FUNCTION IDNAME(NAME)
C
	IMPLICIT NONE
	CHARACTER NAME*(*)
C
#include "UDLIST.FOR"
#include "ERRORS.FOR"
	EXTERNAL TRIM
C
	INTEGER SPOINT, NID, I, NSIZE, ISAVE
C
C	 LOOK FOR THIS NAME IN THE LIST OF OBJECTS' NAMES
C	 IF EXACT MATCH IS FOUND, THEN RETURN IT.
C	 OTHERWISE SAVE FIRST ABBREVIATED MATCH.
C
	NSIZE=TRIM(NAME)
	ISAVE=0
	DO 10 I=1,NOBJ
	IF( NAMOBJ(I).EQ.NAME )THEN
	  IDNAME=I
	  RETURN
	ELSE IF(INDEX(NAMOBJ(I),NAME(:NSIZE)).EQ.1)THEN
	  IF(ISAVE.EQ.0)ISAVE=I
	END IF
 10   CONTINUE
C
C	 RETURN FIRST ABBREVIATED MATCH, OR ZERO IF NO MATCH AT ALL.
C
	IDNAME=ISAVE
	RETURN
	END
C
C
	SUBROUTINE NAMID(ARG,SPOINT,NID)
C
	IMPLICIT NONE
	CHARACTER ARG*(*)
	INTEGER SPOINT, NID
C
#include "UDLIST.FOR"
#include "ERRORS.FOR"
C
	CHARACTER NAME*(NAMMAX)
C
	CALL NAMEID(ARG,SPOINT,NID,NAME)
C
	RETURN
	END
